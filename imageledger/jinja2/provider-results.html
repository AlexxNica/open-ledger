{% import "includes/pagination.html" as pagination %}
{% import "includes/image-result.html" as image_result %}

{% extends "base.html" %}

{% block body %}

<div class="row column" style="margin-top: 1rem">
  <h3>Partner API aggregation</h3>
  <p>
    Images displayed here are provided directly by Flickr, 500px, Rijksmuseum, and Wikimedia Commons.
  </p>
</div>

{% with %}
  {% set endpoint = url('provider-apis') %}
  {% include "includes/search-form.html" %}
{% endwith %}

{% if results %}
  {% set caller = "partner_api" %}

  <div class="row column results">

    <!-- Flickr -->
    {% if 'flickr' in results and results.flickr and results.flickr.photos.total > 0 %}
      <h5>Page {{ results.flickr.photos.page }} of {{ results.flickr.photos.pages }} page{{ results.flickr.photos.pages|pluralize }} from Flickr</h5>

      {{ pagination.paginate_api('flickr', results.flickr.photos.page, results.flickr.photos.pages, form)}}

      <div class="row">
        {% for result in results.flickr.photos.photo %}
          {% with image = {} %}
            {% do image.update({'identifier': None,
                                'creator': result.ownername,
                                'creator_url': "",
                                'url':  result.url,
                                'license': license_map.flickr.get(result.license|int, "").lower(),
                                'provider_url': "https://www.flickr.com/photos/" + result.owner + "/" + result.id,
                                'thumbnail': result.thumbnail,
                                'title': result.title,
                                'provider': "flickr"}) %}
            {% set detail_url = url('by-image', url=image.url, provider_url=image.provider_url, license=image.license, creator=image.creator, title=image.title, provider=image.provider, creator_url=image.creator_url) %}

            {% call image_result.show(detail_url, image) %}{% endcall %}
          {% endwith %}
        {% endfor %}

      </div>
     {{ pagination.paginate_api('flickr', results.flickr.photos.page, results.flickr.photos.pages, form)}}

    {% endif %}

    <!-- 500px -->
    {% if 'fpx' in results and results.fpx and results.fpx.total_items > 0 %}
      <h5>Page {{ results.fpx.current_page }} of {{ results.fpx.total_pages }} page{{ results.fpx.total_pages|pluralize }} from 500px</h5>

      {{ pagination.paginate_api('fpx', results.fpx.current_page, results.fpx.total_pages, form) }}

      <div class="row">
        {% for result in results.fpx.photos %}
          {% with image = {} %}
            {% do image.update({'identifier': None,
                                'creator': result.user.username,
                                'creator_url': "",
                                'license': license_map.fpx.get(result.license_type, "").lower(),
                                'provider_url': "https://500px.com/" + result.url,
                                'title': result.name,
                                'url': result.images.1.https_url,
                                'thumbnail': result.images.0.https_url,
                                'provider': "fpx"}) %}
            {% set detail_url = url('by-image', url=image.url, provider_url=image.provider_url, license=image.license, creator=image.creator, title=image.title, provider=image.provider, creator_url=image.creator_url) %}
            {% call image_result.show(detail_url, image) %}{% endcall %}
          {% endwith %}

        {% endfor %}
      </div>

      {{ pagination.paginate_api('fpx', results.fpx.current_page, results.fpx.total_pages, form) }}

    {% endif %}

    <!-- rijksmuseum -->
    {% if 'rijks' in results and results.rijks and results.rijks.count > 0 %}
    <h5>Page {{ results.rijks.page }} of {{ results.rijks.pages }} page{{ results.rijks.pages|pluralize }} from Rijksmuseum</h5>

     {{ pagination.paginate_api('rijks', results.rijks.page, results.rijks.pages, form) }}

      <div class="row">
        {% for result in results.rijks.artObjects %}
          {% with image = {} %}
            {% do image.update({'license': "cc0",
                                'creator': result.principalOrFirstMaker,
                                'creator_url': "",
                                'url': result.webImage.url,
                                'title': result.title,
                                'provider_url': result.links.web,
                                'thumbnail': result.webImage.url,
                                'provider': "rijks",
                                'identifier': None,}) %}
            {% set detail_url = url('by-image', url=image.url, provider_url=image.provider_url, license=image.license, creator=image.creator, title=image.title, provider=image.provider, creator_url=image.creator_url) %}
            {% call image_result.show(detail_url, image) %}{% endcall %}
          {% endwith %}
        {% endfor %}
      </div>

     {{ pagination.paginate_api('rijks', results.rijks.page, results.rijks.pages, form) }}

    {% endif %}

    <!-- Wikimedia -->
    {% if 'wikimedia' in results and results.wikimedia and results.wikimedia.total > 0 %}
    <h5>Page {{ results.wikimedia.page }} of {{ results.wikimedia.pages }} page{{ results.wikimedia.pages|pluralize }} from Wikimedia Commons</h5>

     {{ pagination.paginate_api('wikimedia', results.wikimedia.page, results.wikimedia.pages, form)}}

     <div class="row">
      {% for result in results.wikimedia.results %}
        {% with image = {} %}
          {% do image.update({'license': "cc0",
                              'creator': "",
                              'creator_url': "",
                              'url': result.pic.value,
                              'title': result.itemLabel.value,
                              'provider_url': result.item.value,
                              'thumbnail': result.pic.value,
                              'provider': "wikimedia",
                              'identifier': None}) %}

          {% set detail_url = url('by-image', url=image.url, provider_url=image.provider_url, license=image.license, creator=image.creator, title=image.title, provider=image.provider, creator_url=image.creator_url) %}
          {% call image_result.show(detail_url, image) %}{% endcall %}
        {% endwith %}
      {% endfor %}
     </div>
     {{ pagination.paginate_api('wikimedia', results.wikimedia.page, results.wikimedia.pages, form)}}
    {% endif %}
  </div>
{% endif %}

{% endblock body %}
