{% import "includes/pagination.html" as pagination %}
{% extends "base.html" %}

{% block body %}

<div class="row column" style="margin-top: 1rem">
  <h3>Partner API aggregation</h3>
  <p>
    Images displayed here are provided directly by Flickr, 500px, Rijksmuseum, and Wikimedia Commons.
  </p>
</div>

{% with %}
  {% set endpoint = url_for('index') %}
  {% include "includes/search-form.html" %}
{% endwith %}

{% if results %}
<div class="row column results">

  <!-- Flickr -->
  {% if results.flickr and results.flickr.photos.total > 0 %}
    <h5>Page {{ results.flickr.photos.page }} of {{ results.flickr.photos.total }} photo{{ results.flickr.photos.total|pluralize }} from Flickr</h5>

    {{ pagination.paginate(results.flickr.photos.page, results.flickr.photos.pages, search_data, 'flickr')}}

    <div class="row">
      {% for result in results.flickr.photos.photo %}
      <div class="shrink columns">
        <!-- https://www.flickr.com/photos/{user-id}/{photo-id} - individual photo -->
        <figure>
          <div class="figure-wrapper">
            {% set orig_license = result.license|int %}
            {% set license = license_map.flickr[orig_license].lower() %}
            {% set creator = result.ownername %}
            {% set url = result.url_m %}
            {% set provider_url = "https://www.flickr.com/photos/" + result.owner + "/" + result.id %}
            <a href="{{ url_for('by_image', url=url, provider_url=provider_url, license=license, creator=creator) }}">
              <img src="{{ result.url_m }}" class="thumbnail" width="200" />
            </a>
          </div>
          <figcaption>
            {{ result.ownername }}
            <img src="{{ url_for('static', filename='images/' + license + '.png')}}" alt="{{ license.upper() }}" title="{{ license }}"/ />

          </figcaption>
        </figure>
      </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- 500px -->
  {% if results.fpx and results.fpx.total_items > 0 %}
    <h5>Page {{ results.fpx.current_page }} of {{ results.fpx.total_items }} photo{{ results.fpx.total_items|pluralize }} from 500px</h5>

    {{ pagination.paginate(results.fpx.current_page, results.fpx.total_pages, search_data, 'fpx')}}

    <div class="row">
      {% for result in results.fpx.photos %}
      <div class="shrink columns">
        <figure>
          <div class="figure-wrapper">
            <a href="https://500px.com/{{ result.url }}">
              <img src="{{ result.images.0.https_url }}" class="thumbnail" width="200" />
            </a>
          </div>
          <figcaption>
            {{ result.user.username }}
            <img src="{{ url_for('static', filename='images/' + license_map.fpx[result.license_type].lower() + '.png')}}" alt="{{ license_map.fpx[result.license_type] }}" title="{{ license_map.fpx[result.license_type] }}"/ />
          </figcaption>
        </figure>
      </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- rijksmuseum -->
  {% if results.rijks and results.rijks.count > 0 %}
  <h5>Page {{ results.rijks.page }} of {{ results.rijks.count }} photo{{ results.rijks.count|pluralize }} from Rijksmuseum</h5>

   {{ pagination.paginate(results.rijks.page, results.rijks.pages, search_data, 'rijks')}}

    <div class="row">
      {% for result in results.rijks.artObjects %}
      <div class="shrink columns">
        <figure>
          <div class="figure-wrapper">
            <a href="{{ result.links.web }}">
              <img src="{{ result.webImage.url }}" class="thumbnail" width="200">
            </a>
          </div>
          <figcaption>
            {{ result.title }}
            <img src="{{ url_for('static', filename='images/cc0.png')}}" alt="CC0" title="CC0"/ />
          </figcaption>
        </figure>
      </div>
      {% endfor %}
  </div>
  {% endif %}

  <!-- Wikimedia -->
  {% if results.wikimedia and results.wikimedia.total > 0 %}
  <h5>Page {{ results.wikimedia.page }} of {{ results.wikimedia.total }} photo{{ results.wikimedia.total|pluralize }} from Wikimedia Commons</h5>

   {{ pagination.paginate(results.wikimedia.page, results.wikimedia.pages, search_data, 'wikimedia')}}

  <div class="row">
    {% for result in results.wikimedia.results %}
    <div class="shrink columns">
      <figure>
        <div class="figure-wrapper">
          <a href="{{ result.item.value }}">
            <img src="{{ result.pic.value }}" class="thumbnail" width="200">
          </a>
        </div>
        <figcaption>
          {{ result.itemLabel.value }}
          <img src="{{ url_for('static', filename='images/cc0.png')}}" alt="CC0" title="CC0"/ />
        </figcaption>
      </figure>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>

{% endif %}

{% endblock body %}
